.. tags: Meetings
.. slug: 26-animation-time
.. title: Animation time!
.. date: 04 February 2014 21:12
.. author: Edward Powell

	<h2>
					<a href="https://web.archive.org/web/20170315155221/http://raspberrypilot.com/index.php/meetings/26-animation-time">
			Animation time!</a>
			</h2>





<p><a href="https://web.archive.org/web/20170315155221/http://www.raspberrypilot.com/images/image_2_480459586e35bde96d03da7e590e5419.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; float: left; padding-top: 0px; padding-left: 0px; margin: 0px 6px 6px 0px; border-left: 0px; display: inline; padding-right: 0px" alt="image" src="../../../images/old/image_thumb_3027f409856c75b6f02ba210b446af40.html" border="0" align="left" height="70" width="137"></a>Now
 we have got all of our player-related data into a single dictionary 
container, we can add more images to it and create some cleverer update 
and drawing functions to take our new multi-image player and work out 
which frame to draw.</p>  <p>Firstly we are going to add a <a href="https://web.archive.org/web/20170315155221/http://www.tutorialspoint.com/python/python_lists.htm">python list</a> *inside* the player dictionary. You will remember that the list has the syntax:</p>  <table cellspacing="0" cellpadding="2" border="1" width="600"><tbody>     <tr>       <td width="600" valign="top"><font face="Courier New">python_list = [item1, item2, item3]</font></td>     </tr>   </tbody></table>  <p>and we can access the item using an index into the list (don’t forget the indices start from zero):</p>  <table cellspacing="0" cellpadding="2" border="1" width="600"><tbody>     <tr>       <td width="600" valign="top"><font face="Courier New">item1 == python_list[0]</font></td>     </tr>   </tbody></table>  <p>Our
 list is going to hold all the images for our player. There are two 
frames of animation for four different directions and are named with the
 following convention: player_direction_frame.png</p>  <p>so when we add our list to the player dictionary and associate with the <font color="#008000">“images”</font> key, it looks like this:</p>    <table cellspacing="0" cellpadding="2" border="1" width="600"><tbody>     <tr>       <td width="600" valign="top">         <p><font face="Courier New">player = {             <br>&nbsp;&nbsp;&nbsp; <font color="#008000">"images"</font>:[              <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pygame.image.load(<font color="#008000">"player_left_0.png"</font>),              <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pygame.image.load(<font color="#008000">"player_right_0.png"</font>),               <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pygame.image.load(<font color="#008000">"player_up_0.png"</font>),              <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pygame.image.load(<font color="#008000">"player_down_0.png"</font>),              <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pygame.image.load(<font color="#008000">"player_left_1.png"</font>),              <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pygame.image.load(<font color="#008000">"player_right_1.png"</font>),&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pygame.image.load(<font color="#008000">"player_up_1.png"</font>),              <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pygame.image.load(<font color="#008000">"player_down_1.png"</font>)              <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ],              <br>&nbsp;&nbsp;&nbsp; <font color="#008000">"rect"</font>:pygame.Rect(0, 0, 32, 32),              <br>&nbsp;&nbsp;&nbsp; <font color="#008000">"start_rect"</font>:pygame.Rect(0, 0, 32, 32),              <br>&nbsp;&nbsp;&nbsp; <font color="#008000">"speed"</font>:4,              <br>&nbsp;&nbsp;&nbsp; <font color="#008000">"direction"</font>:0              <br>&nbsp;&nbsp;&nbsp; }</font></p>       </td>     </tr>   </tbody></table>  <p>Hopefully you can see that the images are added in the order</p>  <p>frame 1: left, right, up, down </p>  <p>frame 2: left, right, up, down</p>  <p>Which will be important to remember later.</p>  <p>You can also see an final extra data item at the end of the player dictionary,<font color="#008000"> “direction”</font>, that we will use to keep track of which way our player is facing.</p>  <p>The
 update player position function now needs to set the direction, which 
will form part of the index we need to choose the right image from our 
new list:</p>  <table cellspacing="0" cellpadding="2" border="1" width="600"><tbody>     <tr>       <td width="600" valign="top">         <p><font face="Courier New"><font color="#ffc000">def</font> <font color="#0000ff">UpdatePlayerPosition</font>(player, walls):              <br>&nbsp;&nbsp;&nbsp; player_move_rect = player[<font color="#008000">'rect'</font>]              <br>&nbsp;&nbsp;&nbsp; speed = player[<font color="#008000">'speed'</font>]              <br>&nbsp;&nbsp;&nbsp; <font color="#ff0000"># Read the keyboard input and move the marker               <br></font>&nbsp;&nbsp;&nbsp; key = pygame.key.get_pressed()              <br>&nbsp;&nbsp;&nbsp; <font color="#ffc000">if</font> key[pygame.K_LEFT]:              <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font style="background-color: #ffff00">player["direction"] = 0               <br></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; player_move_rect = player_move_rect.move(-<font face="Courier New">speed</font><font face="Courier New">, 0)               <br>&nbsp;&nbsp;&nbsp; <font color="#ffc000">if</font> key[pygame.K_RIGHT]:                <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font style="background-color: #ffff00">player["direction"] = 1                 <br></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; player_move_rect = player_move_rect.move(speed, 0)                <br>&nbsp;&nbsp;&nbsp; <font color="#ffc000">if</font> key[pygame.K_UP]:                <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font style="background-color: #ffff00">player["direction"] = 2</font>                 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; player_move_rect = player_move_rect.move(0, -speed)                <br>&nbsp;&nbsp;&nbsp; <font color="#ffc000">if</font> key[pygame.K_DOWN]:                <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font style="background-color: #ffff00">player["direction"] = 3</font>                 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; player_move_rect = player_move_rect.move(0, speed)</font>              </font></p><p><font face="Courier New"><font face="Courier New">&nbsp;&nbsp; </font></font></p><font face="Courier New">  <font color="#ff0000"># Only if the marker has not hit a wall do we update the player               <br></font>&nbsp;&nbsp;&nbsp; <font color="#ffc000">if</font> player_move_rect.collidelist(walls) == -1:              <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; player[<font color="#008000">'rect'</font>] = player_move_rect</font><p></p>       </td>     </tr>   </tbody></table>  <p>Now we can add a draw function to pull together everything we have put into place. </p>  <table cellspacing="0" cellpadding="2" border="1" width="600"><tbody>     <tr>       <td width="600" valign="top">         <p><font face="Courier New"><font color="#ffc000">def</font> <font color="#0000ff">DrawPlayer</font>(player):              <br>&nbsp;&nbsp;&nbsp; animation_step = player[<font color="#008000">"speed"</font>] * 3              <br>&nbsp;&nbsp;&nbsp; image_index = player[<font color="#008000">"direction"</font>]              <br>&nbsp;&nbsp;&nbsp; if image_index &lt; 2: <font color="#ff0000"># Moving left/right?</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (player[<font color="#008000">"rect"</font>].left // animation_step) % 2:              <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; image_index = image_index + 4              <br>&nbsp;&nbsp;&nbsp; else: <font color="#ff0000"># Moving Up/Down</font>              <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (player[<font color="#008000">"rect</font></font><font face="Courier New"><font color="#008000">"</font>].bottom // animation_step) % 2:              <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; image_index = image_index + 4              <br>&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp; screen.blit(player[<font color="#008000">"images"</font>][image_index], player[<font color="#008000">"rect"</font>])</font></p>       </td>     </tr>   </tbody></table>  <p>This is a fairly complicated function. <font face="Courier New">animation_step</font> is the variable that will determine how often we will change the image frame – it must be a multiple of <font face="Courier New">player["speed"]</font>
 to ensure that we will actually hit these steps. Initially we get the 
image_index directly from the direction. we know that we are moving 
left/right if the index is less than 2 and we use the left-hand position
 of the player rectangle to pick the image frame we’re going to use. We 
divide it by the <font face="Courier New">animation_step</font> to find 
give us our horizontal position in ‘steps’ (the // is a special divide 
that will round the result to a whole number) then we see if it is an 
odd or even step using <a href="https://web.archive.org/web/20170315155221/http://www.tutorialspoint.com/python/python_basic_operators.htm">modulus (%)</a>
 2. If it is an odd numbered step then we bump the image_index up by 4, 
which if you remember how the image list was ordered from above, will 
now make it one of the frame 1 images.</p>  <p>Essentially we do the same thing, but based on the position of the bottom of the player rectangle if we are moving up/down.</p>  <p>In our main loop we can now just add calls to these functions:</p>  <table cellspacing="0" cellpadding="2" border="1" width="600"><tbody>     <tr>       <td width="600" valign="top"><font face="Courier New">UpdatePlayerPosition(player, walls)           <br>DrawPlayer(player)</font></td>     </tr>   </tbody></table>  <p>the
 game loop is *a lot* neater, but more importantly we can now improve or
 replace these functions very easily without affecting any other parts 
of our game.</p>



